<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Programming Adventure!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono:wght@300;400;700&family=Roboto:wght@300;400;500&display=swap');

        :root {
            /* Theme variables from previous */
            --bg-color: #0a0f23; --primary-color: #00f7ff; --secondary-color: #f72585; --accent-color: #70ff00;
            --danger-color: #ff4d4d; --text-color: #d0e0ff; --card-bg: rgba(8, 12, 35, 0.96);
            --border-color: rgba(0, 247, 255, 0.5); --shadow-color: rgba(0, 247, 255, 0.4);
            --glow-color-primary: rgba(0, 247, 255, 0.7); --glow-color-secondary: rgba(247, 37, 133, 0.6);
            --glow-color-accent: rgba(112, 255, 0, 0.6); --glow-color-danger: rgba(255, 77, 77, 0.6);
            --slider-track: rgba(255, 255, 255, 0.15); --slider-thumb-default: var(--primary-color);
            --scanline-opacity: 0.07; --border-animation-speed: 5s;
            --activity-bg: rgba(15, 25, 55, 0.75); --button-bg: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            --button-text-color: #030615; --feedback-correct-bg: rgba(112, 255, 0, 0.15);
            --feedback-incorrect-bg: rgba(255, 77, 77, 0.15);
            --flowchart-symbol-bg: rgba(255,255,255,0.08); --flowchart-symbol-border: var(--primary-color);
            --robot-body-color: #7f8c8d; --robot-accent-color: var(--primary-color);
            --battery-full-color: var(--accent-color); --battery-low-color: var(--danger-color);
            --progress-bar-color: var(--secondary-color);
            --status-best: #27ae60; --status-ok: var(--accent-color);
            --status-bad: var(--danger-color); --status-critical: #e74c3c;
        }

        /* --- Base Theme & Page Structure --- */
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Roboto', sans-serif; line-height: 1.6; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; box-sizing: border-box; overflow: hidden; }
        body::before, body::after { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        body::before { background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), repeating-linear-gradient( 0deg, transparent, transparent 2px, rgba(0, 247, 255, var(--scanline-opacity)) 3px, rgba(0, 247, 255, var(--scanline-opacity)) 4px ); background-size: 100% 7px; animation: scanlines 0.25s linear infinite; }
        body::after { background-image: linear-gradient(rgba(0, 247, 255, 0.04) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 247, 255, 0.04) 1px, transparent 1px); background-size: 60px 60px; animation: backgroundGrid 20s linear infinite; }
        @keyframes scanlines { 0% { background-position: 0 0; } 100% { background-position: 0 7px; } }
        @keyframes backgroundGrid { 0% { background-position: 0 0; } 100% { background-position: 60px 60px; } }
        
        .adventure-container { width: 100%; max-width: 1200px; height: 96vh; max-height: 850px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 25px; box-shadow: 0 0 50px var(--shadow-color), 0 0 20px rgba(0,0,0,0.6) inset; display: flex; flex-direction: column; position: relative; backdrop-filter: blur(10px); overflow: hidden; }
        .adventure-container::before, .adventure-container::after { content: ''; position: absolute; z-index: -1; border-radius: inherit; } /* Corrected 'inherit' spelling */
        .adventure-container::before {top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient( transparent, rgba(0, 247, 255, 0.3), transparent 30% ); animation: rotateBorder var(--border-animation-speed) linear infinite; }
        .adventure-container::after { inset: 1px; background: var(--card-bg); }
        @keyframes rotateBorder { 100% { transform: rotate(360deg); } }

        header { text-align: center; padding: 20px 30px 15px; border-bottom: 1px solid var(--border-color); flex-shrink: 0; }
        header h1 { font-family: 'Orbitron', sans-serif; color: var(--primary-color); font-size: 2.3em; margin: 0; text-shadow: 0 0 15px var(--glow-color-primary), 0 0 8px #fff; letter-spacing: 2px; }
        
        #page-container { flex-grow: 1; overflow-y: auto; padding: 20px 35px; position: relative; }
        .page { display: none; flex-direction: column; gap: 20px; animation: fadeIn 0.5s ease-out; }
        .page.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .narrative-section, .content-section { background: var(--activity-bg); padding: 20px 25px; border-radius: 15px; border: 1px solid rgba(0, 247, 255, 0.2); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .content-section { margin-bottom: 25px; }
        .narrative-section p, .content-section p { margin-bottom: 12px; font-size: 1.0em; line-height: 1.7; }
        .narrative-section .highlight, .content-section .highlight { color: var(--accent-color); font-weight: 500; text-shadow: 0 0 6px var(--glow-color-accent); }
        .narrative-section .important, .content-section .important { color: var(--primary-color); font-weight: 500; text-shadow: 0 0 6px var(--glow-color-primary); }
        .narrative-section .critical, .content-section .critical { color: var(--danger-color); font-weight: 500; text-shadow: 0 0 6px var(--glow-color-danger); }
        .narrative-section .emphasis { font-style: italic; opacity: 0.9; }
        .content-section h2, .narrative-section h2 { font-family: 'Orbitron', sans-serif; color: var(--secondary-color); margin: -20px -25px 15px -25px; padding: 12px 25px; border-top-left-radius: 15px; border-top-right-radius: 15px; background: linear-gradient(145deg, rgba(247, 37, 133, 0.1), rgba(0, 247, 255, 0.05)); border-bottom: 1px solid var(--border-color); font-size: 1.25em; display: flex; align-items: center; gap: 10px; text-shadow: 0 0 8px var(--glow-color-secondary);}
        .content-section h2 .sim-icon, .narrative-section h2 .sim-icon { width: 1.1em; height: 1.1em; fill: currentColor; opacity: 0.8; }
        .content-section .challenge-goal { font-weight: 500; color: var(--secondary-color); background-color: rgba(0,0,0,0.25); padding: 6px 12px; border-radius: 5px; display: inline-block; margin-top: 5px; border: 1px dashed var(--secondary-color); }

        /* --- Activity Styles (General) --- */
        .activity-question { margin-bottom: 10px; font-weight: 500; font-size:1.05em; }
        .activity-options label { display: block; margin: 8px 0; padding: 10px 15px; background-color: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); border-radius: 8px; cursor: pointer; transition: background-color 0.2s, border-color 0.2s; display: flex; align-items: center; }
        .activity-options label:hover { background-color: rgba(255,255,255,0.1); border-color: var(--primary-color); }
        .activity-options input[type="radio"], .activity-options input[type="checkbox"] { margin-right: 12px; accent-color: var(--primary-color); transform: scale(1.2); flex-shrink: 0; }
        .activity-button { background: var(--button-bg); color: var(--button-text-color); font-family: 'Orbitron', sans-serif; font-size: 1em; font-weight: bold; border: none; padding: 10px 22px; border-radius: 25px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 0 12px rgba(0, 247, 255, 0.6), 0 0 8px rgba(112, 255, 0, 0.5), 0 3px 6px rgba(0,0,0,0.3); margin-top:15px; letter-spacing: 1px; }
        .activity-button:hover:not(:disabled) { transform: translateY(-2px) scale(1.03); box-shadow: 0 0 18px rgba(0, 247, 255, 0.8), 0 0 12px rgba(112, 255, 0, 0.7), 0 5px 10px rgba(0,0,0,0.4); }
        .activity-button:disabled { background: #555; color: #999; opacity: 0.6; cursor: not-allowed; box-shadow: none; }
        .feedback-message { margin-top: 12px; padding: 10px; border-radius: 8px; font-weight: 500; text-align: center; font-size: 0.95em; border: 1px solid transparent; }
        .feedback-message.correct { background-color: var(--feedback-correct-bg); border-color: var(--status-best); color: var(--status-best); box-shadow: 0 0 8px var(--status-best) inset; }
        .feedback-message.incorrect { background-color: var(--feedback-incorrect-bg); border-color: var(--danger-color); color: var(--danger-color); box-shadow: 0 0 8px var(--danger-color) inset; }
        .code-snippet { background-color: rgba(0,0,0,0.5); border-left: 5px solid var(--accent-color); padding: 15px; border-radius: 6px; font-family: 'Roboto Mono', monospace; white-space: pre-wrap; margin: 15px 0; font-size: 0.9em; box-shadow: 3px 3px 10px rgba(0,0,0,0.3); }
        .code-snippet .comment { color: #8da2b0; font-style: italic; } .code-snippet .keyword { color: var(--secondary-color); font-weight:bold; } .code-snippet .variable { color: var(--primary-color); } .code-snippet .value { color: var(--accent-color); font-weight:bold;}
        .activity-slider-group { margin: 20px 0; padding: 15px; background: rgba(0,0,0,0.1); border-radius: 8px; }
        .activity-slider-group label { display: block; margin-bottom: 8px; font-weight: 500; font-family: 'Roboto', sans-serif; font-size: 0.95em; color: var(--primary-color); }
        .activity-slider-group input[type="range"] { width: 100%; appearance: none; -webkit-appearance: none; height: 10px; background: var(--slider-track); border-radius: 5px; cursor: pointer; outline: none; border: 1px solid rgba(255,255,255,0.2); }
        .activity-slider-group input[type="range"]::-webkit-slider-thumb { appearance: none; -webkit-appearance: none; width: 22px; height: 22px; background: var(--slider-thumb-default); border-radius: 50%; border: 3px solid var(--bg-color); box-shadow: 0 0 10px var(--slider-thumb-default), 0 0 5px #fff; cursor: pointer; margin-top: -6px; }
        .activity-slider-group input[type="range"]::-moz-range-thumb { width: 20px; height: 20px; background: var(--slider-thumb-default); border-radius: 50%; border: 3px solid var(--bg-color); box-shadow: 0 0 10px var(--slider-thumb-default), 0 0 5px #fff; cursor: pointer; }
        .activity-slider-output { font-family: 'Roboto Mono', monospace; font-size: 1.1em; color: var(--accent-color); background: rgba(0,0,0,0.35); padding: 10px 15px; border-radius: 6px; text-align: center; margin-top: 10px; border: 1px solid var(--accent-color); box-shadow: 0 0 8px var(--glow-color-accent) inset; }
        .pseudocode-fill input[type="text"], .pseudocode-fill select { background-color: rgba(255,255,255,0.1); border: 1px solid var(--primary-color); color: var(--text-color); padding: 6px 10px; border-radius: 5px; font-family: 'Roboto Mono', monospace; width: auto; min-width:90px; margin: 0 5px; text-align: center; font-size: 0.95em;}
        #flowchart-steps-container { list-style: none; padding: 0; margin: 15px 0; border: 2px dashed rgba(0, 247, 255, 0.2); padding: 10px; border-radius: 8px; min-height: 150px; background: rgba(0,0,0,0.1); }
        #flowchart-steps-container li { background-color: var(--flowchart-symbol-bg); border: 1px solid var(--flowchart-symbol-border); padding: 12px 18px; margin-bottom: 10px; border-radius: 8px; cursor: grab; user-select: none; font-family: 'Roboto Mono', monospace; font-size: 0.95em; box-shadow: 2px 2px 8px rgba(0,0,0,0.3); transition: background-color 0.2s; }
        #flowchart-steps-container li:hover { background-color: rgba(0, 247, 255, 0.1); }
        #flowchart-steps-container li.dragging { opacity: 0.6; background-color: var(--accent-color); color: #000; border-color: var(--accent-color); }

        /* --- Navigation Controls --- */
        .navigation-controls { padding: 20px 35px; border-top: 1px solid var(--border-color); text-align: right; flex-shrink: 0; background-color: var(--card-bg); border-bottom-left-radius: 25px; border-bottom-right-radius: 25px;}
        #nextButton { /* Uses .activity-button styles */ }

        /* --- Main Simulation Styles (Robot Themed) --- */
        .simulation-core { display: flex; gap: 25px; flex-wrap: wrap; align-items: flex-start; }
        .simulation-visuals { flex: 1.2; min-width:clamp(320px, 100%, 550px); background: rgba(0,0,0,0.4); border-radius: 10px; padding: 15px; border: 1px dashed var(--border-color); }
        .simulation-controls-data { flex: 1; min-width: 300px; display: flex; flex-direction: column; gap: 18px; }
        #robot-sim-svg { width: 100%; height: auto; aspect-ratio: 16 / 9; background-color: #2c3e50; border-radius: 8px; overflow: hidden; position: relative; }
        #robot-main-avatar { transform-origin: center 20px; /* Robot body center-bottom for rotation */ } /* Added for rotation point */
        #robot-avatar { fill: var(--robot-body-color); stroke: var(--robot-accent-color); stroke-width: 2; transition: transform 0.5s ease-out; }
        #robot-tool { fill: var(--secondary-color); transition: opacity 0.5s ease, transform 0.2s linear; transform-origin: 0% 50%;} /* Tool pivot */
        .sim-progress-bar-bg { fill: rgba(255,255,255,0.1); }
        #sim-progress-bar-fg { fill: var(--progress-bar-color); transition: width 0.15s linear; } /* Faster progress bar update */
        #sim-battery-icon { fill: #bdc3c7; }
        #sim-battery-level { fill: var(--battery-full-color); transition: height 0.15s linear, y 0.15s linear, fill 0.5s ease-out; transform-origin: bottom left;}
        .simulation-controls-data input[type="range"].complexity-slider::-webkit-slider-thumb { background: var(--secondary-color); box-shadow: 0 0 10px var(--secondary-color), 0 0 5px #fff; }
        .simulation-controls-data input[type="range"].complexity-slider::-moz-range-thumb { background: var(--secondary-color); box-shadow: 0 0 10px var(--secondary-color), 0 0 5px #fff; }
        .simulation-controls-data input[type="range"].power-slider::-webkit-slider-thumb { background: var(--accent-color); box-shadow: 0 0 10px var(--accent-color), 0 0 5px #fff; }
        .simulation-controls-data input[type="range"].power-slider::-moz-range-thumb { background: var(--accent-color); box-shadow: 0 0 10px var(--accent-color), 0 0 5px #fff; }
        .data-readout { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; font-family: 'Roboto Mono', monospace; display: grid; grid-template-columns: auto 1fr; gap: 8px 12px; }
        .data-readout .label { font-size: 0.9em; color: var(--primary-color); } .data-readout .value { font-size: 1em; }
        #robot-sim-status-area { grid-column: 1 / -1; text-align: center; padding-top: 10px; border-top: 1px dashed var(--border-color); margin-top: 8px; }
        #robot-sim-status { font-size: 1.2em; font-weight: bold; } #robot-sim-status-text { font-size: 0.85em; opacity: 0.85; }
        .data-readout .value.status-optimal { color: var(--status-best); text-shadow: 0 0 6px var(--status-best); }
        .data-readout .value.status-warning { color: var(--status-ok); text-shadow: 0 0 6px var(--glow-color-accent); }
        .data-readout .value.status-danger { color: var(--status-bad); text-shadow: 0 0 6px var(--glow-color-danger); }
        .data-readout .value.status-critical { color: var(--status-critical); text-shadow: 0 0 7px var(--status-critical); font-weight: bold; }
        #simSystemStatus { font-size: 0.9em; padding: 10px; margin-top:12px;}

        /* Responsive Design adjustments */
        @media (max-width: 768px) { header h1 { font-size: 1.9em; } .adventure-container { height: 92vh; } #page-container { padding: 15px 25px; } .content-section h2, .narrative-section h2 { font-size: 1.15em; } .narrative-section p, .content-section p { font-size: 0.95em; } .activity-button, #nextButton { font-size: 0.9em; padding: 9px 18px; } }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }

    </style>
</head>
<body>
    <!-- Embedded SVG Icons -->
    <svg width="0" height="0" style="position:absolute;">
        <symbol id="icon-data" viewBox="0 0 24 24"><path fill="currentColor" d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/></symbol>
        <symbol id="icon-sensor" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></symbol>
        <symbol id="icon-algorithm" viewBox="0 0 24 24"><path fill="currentColor" d="M17 7H7c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zM7 9h10v6H7V9zm2 1v4h2V10H9zm4 0v4h2V10h-2z"/></symbol>
        <!-- CORRECTED Flowchart Icon Path -->
        <symbol id="icon-flowchart" viewBox="0 0 24 24"><path fill="currentColor" d="M21 9V7h-2V4h-3V2H9v2H6v3H3v2H1v8h2v2H1v-2h2v-2h3V9h3v2h6V9h3zm-8 8H9v-2H7v-2H5v-2h2V9h2V7h2v2h2v2h2v2h-2v2h-2v2z"/></symbol>
        <symbol id="icon-code" viewBox="0 0 24 24"><path fill="currentColor" d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></symbol>
        <symbol id="icon-factory" viewBox="0 0 24 24"><path fill="currentColor" d="M22 9.97V20H2V9.97l10-7l10 7zM12 6l-6 4.2V18h12V10.2L12 6zm-3 8h2v2H9v-2zm4 0h2v2h-2v-2z"/></symbol>
        <symbol id="icon-robot" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a2 2 0 00-2 2v2H8a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V8a2 2 0 00-2-2h-2V4a2 2 0 00-2-2zm0 2h.01M8 8h8v10H8V8zm2 2v2h4v-2H10zm0 4v2h4v-2H10z"/></symbol>
        <symbol id="icon-gear" viewBox="0 0 24 24"><path fill="currentColor" d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49 1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></symbol>
        <symbol id="icon-battery" viewBox="0 0 24 24"><path fill="currentColor" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V19.5c0 .73.6 1.33 1.33 1.33h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4z"/></symbol> <!-- Better battery icon -->
        <symbol id="icon-tool" viewBox="0 0 24 24"><path fill="currentColor" d="M21.41 9.41l-1.83-1.83L18.17 6H16v-2h-2v2h-2.17l-1.41-1.41L8.59 4.59 7.17 6H5v2H3v2h2v2.17l1.41 1.41L4.59 15.41l1.83 1.83L8 15.83V18h2v2h2v-2h2.17l1.41 1.41 1.83-1.83L15.83 14H18v-2h2v-2h-2V7.83l1.41-1.42zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z"/></symbol>
    </svg>

    <div class="adventure-container">
        <header>
            <h1>Robot Programming Adventure!</h1>
        </header>

        <div id="page-container">
            <!-- PAGES (HTML structure from previous response, slightly condensed for brevity here) -->
            <!-- Page 1: Intro -->
            <div class="page active" id="page-intro"> <section class="narrative-section"> <h2><svg class="sim-icon" viewBox="0 0 24 24"><use href="#icon-robot"/></svg> Greetings, Robot Engineer!</h2> <p>Welcome to the high-tech world of robotics! You're about to become a programmer for our advanced factory robots.</p> <p>Robots use <span class="important">data</span> from their sensors and follow <span class="highlight">algorithms</span> (step-by-step instructions) to do their jobs, like assembling gadgets or moving parts.</p> <p>In this adventure, you'll learn how to think like a robot programmer. We'll explore data, create rules, and then you'll optimize a robot's performance in the <span class="emphasis">Task Optimizer</span>! Ready to power up?</p> </section> </div>
            <!-- Page 2: Activity 1 - Spot Data -->
            <div class="page" id="page-activity1"> <section class="content-section"> <h2><svg class="sim-icon" viewBox="0 0 24 24"><use href="#icon-data"/></svg> Activity 1: Robot Sensor Readings!</h2> <p>Robots "see" the world through data from their sensors. Which of these are pieces of data a robot might use?</p> <div class="activity-options" id="activity1-options"> <label><input type="checkbox" name="act1" value="distance"> A) Distance to nearest object: 2.5 meters.</label> <label><input type="checkbox" name="act1" value="robot_mood"> B) The robot seems happy today.</label> <label><input type="checkbox" name="act1" value="battery_level"> C) Battery charge: 78%.</label> <label><input type="checkbox" name="act1" value="motor_speed"> D) Motor RPM (speed): 1200.</label> </div> <button class="activity-button" onclick="checkActivity('activity1', {distance: true, battery_level: true, motor_speed: true}, 'checkbox', 'Correct! Robots use specific measurements like distance, battery, and speed. Feelings are for humans!', 'Not quite. Think about what a robot can actually measure or know.')">Check Data Readings</button> <div class="feedback-message" id="activity1-feedback"></div> </section> </div>
            <!-- Page 3: Activity 2 - Data Types -->
            <div class="page" id="page-activity2"> <section class="content-section"> <h2><svg class="sim-icon" viewBox="0 0 24 24"><use href="#icon-data"/></svg> Activity 2: Sorting Robot Data!</h2> <p>Data comes in different "flavors" or types. Let's sort these robot facts into their correct data type boxes!</p> <p class="activity-question">1. Robot Model Number (e.g., RX-8, T-1000):</p> <div class="activity-options"> <label><input type="radio" name="act2_q1" value="number"> Number (for math)</label> <label><input type="radio" name="act2_q1" value="text"> Text/String (letters & numbers as words)</label> <label><input type="radio" name="act2_q1" value="boolean"> True/False (yes/no)</label> </div> <p class="activity-question">2. Robot Arm Length (e.g., 0.75 meters, 1.2 meters):</p> <div class="activity-options"> <label><input type="radio" name="act2_q2" value="number_decimal"> Number with Decimals (Float)</label> <label><input type="radio" name="act2_q2" value="text"> Text/String</label> <label><input type="radio" name="act2_q2" value="boolean"> True/False</label> </div> <p class="activity-question">3. Is the robot's power on? (e.g., True/Yes):</p> <div class="activity-options"> <label><input type="radio" name="act2_q3" value="number"> Number</label> <label><input type="radio" name="act2_q3" value="text"> Text/String</label> <label><input type="radio" name="act2_q3" value="boolean"> True/False</label> </div> <button class="activity-button" onclick="checkMultiMCQ('activity2', [{q: 'act2_q1', a: 'text'}, {q: 'act2_q2', a: 'number_decimal'}, {q: 'act2_q3', a: 'boolean'}], 'Excellent! Model numbers are text, lengths can have decimals, and power status is True/False.')">Check Data Sort</button> <div class="feedback-message" id="activity2-feedback"></div> </section> </div>
            <!-- Page 4: Activity 3 - Data Limits (Arm) -->
            <div class="page" id="page-activity3"> <section class="content-section"> <h2><svg class="sim-icon" viewBox="0 0 24 24"><use href="#icon-sensor"/></svg> Activity 3: Robot Arm's Reach!</h2> <p>This robot's arm can only extend from <span class="important">0.5 meters</span> to <span class="important">2.0 meters</span>. Any other command is outside its limits!</p> <div class="activity-slider-group"> <label for="targetReachSlider">Commanded Arm Extension: <span id="targetReachValue">1.0m</span></label> <input type="range" id="targetReachSlider" min="0" max="3" value="1.0" step="0.1"> <p>Robot Arm Actually Extends To: <span class="activity-slider-output" id="actualArmReachOutput">1.0m</span></p> </div> <div class="feedback-message" id="activity3-feedback">Slide to command the arm. Watch what it *actually* does!</div> </section> </div>
            <!-- Page 5: Activity 4 - Data Limits (Battery) -->
            <div class="page" id="page-activity4"> <section class="content-section"> <h2><svg class="sim-icon" viewBox="0 0 24 24"><use href="#icon-battery"/></svg> Activity 4: Battery Sensor Check!</h2> <p>A robot's battery sensor isn't always perfect. This one has a <span class="highlight">+/- 5% error range</span>.</p> <div class="activity-slider-group"> <label for="actualBatterySlider">Actual Battery Level: <span id="actualBatteryValue">70%</span></label> <input type="range" id="actualBatterySlider" min="0" max="100" value="70" step="1"> </div> <div class="activity-slider-group"> <label for="sensorNoiseSlider">Sensor "Noise" (Random Error within +/-5%): <span id="sensorNoiseValue">0%</span></label> <input type="range" id="sensorNoiseSlider" min="-5" max="5" value="0" step="1"> <p class="emphasis">(This slider simulates the random error)</p> </div> <p>Sensor Reports Battery At: <span class="activity-slider-output" id="reportedBatteryOutput">70%</span></p> <div class="feedback-message" id="activity4-feedback">Change the actual battery and sensor noise. See how the reported value can be off?</div> </section> </div>
            <!-- Page 6: Activity 5 - Pseudocode -->
            <div class="page" id="page-activity5"> <section class="content-section"> <h2><svg class="sim-icon" viewBox="0 0 24 24"><use href="#icon-algorithm"/></svg> Activity 5: Robot Cleaning Protocol!</h2> <p>Let's write pseudocode for a robot that cleans if a room is messy.</p> <p>Rule: <span class="emphasis">IF the room_is_messy, THEN the robot_action is "Start Cleaning Cycle". ELSE, robot_action is "Standby Mode".</span></p> <p>Test your rule! Set if the room is messy:</p> <div class="activity-slider-group" style="max-width: 300px; margin-left:auto; margin-right:auto;"> <label for="roomMessySlider">Room Messy? (0=Clean, 1=Messy): <span id="roomMessyValue">Clean</span></label> <input type="range" id="roomMessySlider" min="0" max="1" value="0" step="1"> </div> <div class="pseudocode-fill code-snippet"> <span class="keyword">IF</span> room_is_messy_is <select id="pseudoCleanVal1"><option value="true">True</option><option value="false">False</option></select> <span class="keyword">THEN</span><br>   robot_action = "<input type="text" id="pseudoCleanAction1" value="Start Cleaning" size="15">"<br> <span class="keyword">ELSE</span><br>   robot_action = "<input type="text" id="pseudoCleanAction2" value="Standby Mode" size="15">"<br> <span class="keyword">END IF</span> <hr style="border-color: var(--border-color); margin: 10px 0;"> Current Robot Action Based on Slider: <span class="activity-slider-output" id="pseudoCleanOutput" style="display:inline-block; padding: 5px 10px; margin-left:10px;">Standby Mode</span> </div> <button class="activity-button" onclick="checkActivity5()">Check Cleaning Rule</button> <div class="feedback-message" id="activity5-feedback"></div> </section> </div>
            <!-- Page 7: Activity 6 - Flowchart -->
            <div class="page" id="page-activity6"> <section class="content-section"> <h2><svg class="sim-icon" viewBox="0 0 24 24"><use href="#icon-flowchart"/></svg> Activity 6: Robot Assembly Line!</h2> <p>Drag these steps into the correct order for a robot assembling a simple gadget!</p> <ul id="flowchart-steps-container"> </ul> <button class="activity-button" onclick="checkActivity6()">Check Assembly Plan</button> <div class="feedback-message" id="activity6-feedback"></div> </section> </div>
            <!-- Page 8: Code Structure -->
            <div class="page" id="page-activity7"> <section class="content-section"> <h2><svg class="sim-icon" viewBox="0 0 24 24"><use href="#icon-code"/></svg> Activity 7: Robot Code - Charging Up!</h2> <p>This is a piece of JavaScript code that tells a robot how to charge its battery. Functions are like special recipes for the robot!</p> <div class="code-snippet"> <pre><span class="comment">// This function tells the robot to charge if battery is low.</span> <span class="keyword">function</span> <span class="variable">chargeRobotIfNeeded</span>(<span class="variable">currentBatteryLevel</span>) { <span class="keyword">let</span> <span class="variable">lowBatteryThreshold</span> = <span class="value">20</span>; <span class="comment">// Charge if below 20%</span> <span class="keyword">let</span> <span class="variable">robotAction</span> = <span class="value">"Continue Task"</span>; <span class="comment">// Default action</span> <span class="keyword">if</span> (<span class="variable">currentBatteryLevel</span> < <span class="variable">lowBatteryThreshold</span>) { <span class="variable">robotAction</span> = <span class="value">"Go to Charging Station!"</span>; } <span class="keyword">return</span> <span class="variable">robotAction</span>; <span class="comment">// Tell the robot what to do.</span> }</pre> </div> <p>It takes the <span class="variable">currentBatteryLevel</span>, checks if it's below the <span class="variable">lowBatteryThreshold</span>, and then decides the <span class="variable">robotAction</span>. Simple and clear instructions!</p> <div class="feedback-message" id="activity7-feedback">Code helps robots make smart decisions!</div> </section> </div>
            <!-- Page 9: Main Simulation -->
            <div class="page" id="page-simulation"> <section class="content-section"> <h2><svg class="sim-icon" viewBox="0 0 24 24"><use href="#icon-factory"/></svg> Robot Task Optimizer!</h2> <p>You're in charge of the factory floor! Adjust <span class="highlight">Task Complexity</span> and robot <span class="critical">Power Allocation</span> to see how efficiently the robot completes its job before its battery runs out.</p> <p class="challenge-goal">Goal: Complete the task with good battery remaining!</p> <div class="simulation-core"> <div class="simulation-visuals"> <svg id="robot-sim-svg" viewBox="0 0 400 225" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet"> <rect width="400" height="225" fill="#34495e"/> <g id="robot-main-avatar" transform="translate(80 112.5) scale(1.5)"> <rect id="robot-avatar" x="-20" y="-30" width="40" height="50" rx="5" fill="var(--robot-body-color)" stroke="var(--robot-accent-color)" stroke-width="1.5"/> <circle cx="0" cy="-20" r="10" fill="var(--robot-body-color)" stroke="var(--robot-accent-color)" stroke-width="1.5"/> <rect id="robot-tool" x="15" y="-5" width="10" height="20" rx="2" fill="var(--secondary-color)"/> </g> <rect x="150" y="50" width="200" height="20" rx="3" class="sim-progress-bar-bg"/> <rect id="sim-progress-bar-fg" x="150" y="50" width="0" height="20" rx="3"/> <text x="155" y="65" font-family="Roboto Mono" font-size="10" fill="#fff">TASK:</text> <rect x="150" y="80" width="50" height="15" rx="2" fill="#444"/> <rect id="sim-battery-level" x="151" y="81" width="48" height="13" rx="1" /> <use href="#icon-battery" x="125" y="78" width="20" height="20" fill="#fff"/> </svg> </div> <div class="simulation-controls-data"> <div class="slider-container"> <label for="taskComplexitySlider">Task Complexity: <span id="taskComplexityValue">5</span></label> <input type="range" id="taskComplexitySlider" class="complexity-slider" min="1" max="10" value="5" step="1"> </div> <div class="slider-container"> <label for="powerAllocationSlider">Power Allocation (%): <span id="powerAllocationValue">50</span></label> <input type="range" id="powerAllocationSlider" class="power-slider" min="10" max="100" value="50" step="5"> </div> <div class="data-readout"> <span class="label">Complexity:</span><span id="readout-complexity" class="value">5</span> <span class="label">Power Use:</span><span id="readout-power" class="value">50%</span> <span class="label">Task Progress:</span><span id="readout-progress" class="value">0%</span> <span class="label">Battery Left:</span><span id="readout-battery" class="value">100%</span> <div id="robot-sim-status-area"> <span id="robot-sim-status" class="value status-optimal">Ready!</span> <span id="robot-sim-status-text">Awaiting commands.</span> </div> </div> <div id="simSystemStatus">Task simulation initiated.</div> <button class="activity-button" id="startSimButton">Start Task Cycle</button> </div> </div> </section> </div>
            <!-- Page 10: Conclusion -->
            <div class="page" id="page-conclusion"> <section class="narrative-section"> <h2><svg class="sim-icon" viewBox="0 0 24 24"><use href="#icon-gear"/></svg> Mission Accomplished, Engineer!</h2> <p>Fantastic work! You've navigated the world of robot data, understood how they follow instructions (algorithms), and even peeked at some real code logic.</p> <p>These concepts are the building blocks for all sorts of cool technology, from smart factories to space-exploring rovers!</p> <p class="important">The way you structured data and thought about step-by-step processes is exactly how real programmers and engineers solve problems. Keep that curious and logical mind sharp!</p> </section> </div>
        </div> <!-- End #page-container -->

        <div class="navigation-controls">
            <button id="nextButton" class="activity-button">Start Adventure!</button>
        </div>
    </div>

    <script>
    // --- Page Navigation & Activity Logic ---
    const pages = document.querySelectorAll('.page');
    const nextButton = document.getElementById('nextButton');
    let currentPageIndex = 0;
    const totalPages = pages.length;
    const pageCompletionStatus = new Array(totalPages).fill(false);

    function updateNextButtonState() {
        const currentPageId = pages[currentPageIndex].id;
        if (currentPageId === 'page-intro' || 
            currentPageId === 'page-activity7' || // Code display is non-blocking
            currentPageId === 'page-simulation' || 
            currentPageId === 'page-conclusion' ||
            pageCompletionStatus[currentPageIndex]) {
            nextButton.disabled = false;
        } else {
            nextButton.disabled = true;
        }
        if (currentPageIndex === 0) nextButton.textContent = "Start Adventure!";
        else if (currentPageIndex === totalPages - 1) nextButton.textContent = "Restart Adventure!";
        else if (currentPageIndex === totalPages - 2 && pages[totalPages-1].id === 'page-conclusion') nextButton.textContent = "View Conclusion";
        else nextButton.textContent = "Next Mission!";
    }
    
    function showPage(index) {
        pages.forEach((page, i) => page.classList.toggle('active', i === index));
        updateNextButtonState();
    }

    nextButton.addEventListener('click', () => {
        if (currentPageIndex < totalPages - 1) {
            currentPageIndex++;
            showPage(currentPageIndex);
            if (pages[currentPageIndex].id === 'page-activity6') initializeFlowchartActivity();
        } else {
            currentPageIndex = 0;
            pageCompletionStatus.fill(false);
            showPage(currentPageIndex);
            // Resetting specific activity states might be needed if they persist visually
            document.querySelectorAll('.feedback-message').forEach(el => { el.textContent = ''; el.className = 'feedback-message';});
            // Example reset for activity 1 checkboxes
            const act1Options = document.getElementById('activity1-options');
            if (act1Options) act1Options.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
             // Could add more resets for other activities if their inputs need clearing
        }
    });

    function markPageComplete() {
        pageCompletionStatus[currentPageIndex] = true;
        updateNextButtonState();
    }
    
    // --- Activity Checkers (Revised) ---
    function checkActivity(activityId, correctAnswers, inputType, successMessage = "Correct!", failureMessage = "Try again!") {
        const feedbackEl = document.getElementById(`${activityId}-feedback`);
        let allCorrect = true;
        let answeredAtLeastOne = false;

        if (inputType === 'checkbox') {
            const options = document.querySelectorAll(`#${activityId}-options input[type="checkbox"]`);
            if (options.length === 0 && Object.keys(correctAnswers).length > 0) { allCorrect = false; /* No options to check but answers expected */ }
            
            options.forEach(option => {
                const isChecked = option.checked;
                const shouldBeChecked = correctAnswers[option.value] === true;
                if (isChecked) answeredAtLeastOne = true;
                if (isChecked !== shouldBeChecked) allCorrect = false;
            });
            // If there are correct answers defined, at least one must be checked for the overall attempt to be valid for success.
            // This handles the case where nothing is checked, but something *should* be.
            const hasDefinedCorrectAnswers = Object.values(correctAnswers).some(val => val === true);
            if (hasDefinedCorrectAnswers && !answeredAtLeastOne && options.length > 0) {
                 allCorrect = false; 
            }
        } else if (inputType === 'radio') {
            const selected = document.querySelector(`#${activityId}-options input[type="radio"]:checked`);
            allCorrect = (selected && selected.value === correctAnswers.answer);
        }

        if (allCorrect) {
            feedbackEl.textContent = successMessage;
            feedbackEl.className = "feedback-message correct";
            markPageComplete();
        } else {
            feedbackEl.textContent = failureMessage;
            feedbackEl.className = "feedback-message incorrect";
            pageCompletionStatus[currentPageIndex] = false; updateNextButtonState();
        }
    }
    
    function checkMultiMCQ(activityId, questionsAndAnswers, successMessage) {
        const feedbackEl = document.getElementById(`${activityId}-feedback`);
        let allCorrect = true;
        questionsAndAnswers.forEach(item => {
            const selected = document.querySelector(`input[name="${item.q}"]:checked`);
            if (!selected || selected.value !== item.a) allCorrect = false;
        });
        if (allCorrect) {
            feedbackEl.textContent = successMessage;
            feedbackEl.className = "feedback-message correct";
            markPageComplete();
        } else {
            feedbackEl.textContent = "Not quite! Check all your answers.";
            feedbackEl.className = "feedback-message incorrect";
            pageCompletionStatus[currentPageIndex] = false; updateNextButtonState();
        }
    }

    // --- Activity 3: Robot Arm Reach ---
    const targetReachSlider = document.getElementById('targetReachSlider');
    const targetReachValue = document.getElementById('targetReachValue');
    const actualArmReachOutput = document.getElementById('actualArmReachOutput');
    const activity3Feedback = document.getElementById('activity3-feedback');
    const ARM_MIN_REACH = 0.5; const ARM_MAX_REACH = 2.0;
    if (targetReachSlider) {
        targetReachSlider.addEventListener('input', () => {
            const commanded = parseFloat(targetReachSlider.value);
            if(targetReachValue) targetReachValue.textContent = commanded.toFixed(1) + "m";
            let actual = commanded;
            let feedbackMsg = "Arm extends as commanded!";
            if(activity3Feedback) activity3Feedback.className = "feedback-message correct";
            if (commanded < ARM_MIN_REACH) { actual = ARM_MIN_REACH; feedbackMsg = `Command too short! Arm extends to minimum ${ARM_MIN_REACH.toFixed(1)}m.`; if(activity3Feedback) activity3Feedback.className = "feedback-message incorrect"; }
            else if (commanded > ARM_MAX_REACH) { actual = ARM_MAX_REACH; feedbackMsg = `Command too far! Arm extends to maximum ${ARM_MAX_REACH.toFixed(1)}m.`; if(activity3Feedback) activity3Feedback.className = "feedback-message incorrect"; }
            if(actualArmReachOutput) actualArmReachOutput.textContent = actual.toFixed(1) + "m";
            if(activity3Feedback) activity3Feedback.textContent = feedbackMsg;
            markPageComplete(); 
        });
    }

    // --- Activity 4: Battery Sensor Check ---
    const actualBatterySlider = document.getElementById('actualBatterySlider');
    const actualBatteryValue = document.getElementById('actualBatteryValue');
    const sensorNoiseSlider = document.getElementById('sensorNoiseSlider');
    const sensorNoiseValue = document.getElementById('sensorNoiseValue');
    const reportedBatteryOutput = document.getElementById('reportedBatteryOutput');
    const activity4Feedback = document.getElementById('activity4-feedback');
    if (actualBatterySlider && sensorNoiseSlider) {
        function updateBatterySensor() {
            const actualBatt = parseInt(actualBatterySlider.value);
            const noise = parseInt(sensorNoiseSlider.value);
            if(actualBatteryValue) actualBatteryValue.textContent = actualBatt + "%";
            if(sensorNoiseValue) sensorNoiseValue.textContent = (noise >= 0 ? "+" : "") + noise + "%";
            let reportedBatt = actualBatt + noise;
            reportedBatt = Math.max(0, Math.min(100, reportedBatt));
            if(reportedBatteryOutput) reportedBatteryOutput.textContent = reportedBatt + "%";
            if(activity4Feedback) {
                if (noise !== 0 && actualBatt !== reportedBatt) {
                    activity4Feedback.textContent = "Notice how the sensor noise makes the reading different from actual!";
                    activity4Feedback.className = "feedback-message incorrect";
                } else if (noise === 0 && actualBatt === reportedBatt) {
                    activity4Feedback.textContent = "With no noise, the sensor is accurate.";
                    activity4Feedback.className = "feedback-message correct";
                } else {
                     activity4Feedback.textContent = "Slide the noise to see its effect!";
                     activity4Feedback.className = "feedback-message";
                }
            }
            markPageComplete(); 
        }
        actualBatterySlider.addEventListener('input', updateBatterySensor);
        sensorNoiseSlider.addEventListener('input', updateBatterySensor);
    }
    
    // --- Activity 5: Pseudocode Cleaning ---
    const roomMessySlider = document.getElementById('roomMessySlider');
    const roomMessyValue = document.getElementById('roomMessyValue');
    const pseudoCleanVal1 = document.getElementById('pseudoCleanVal1');
    const pseudoCleanAction1 = document.getElementById('pseudoCleanAction1');
    const pseudoCleanAction2 = document.getElementById('pseudoCleanAction2');
    const pseudoCleanOutput = document.getElementById('pseudoCleanOutput');
    
    function updatePseudoCleanOutput() {
        if (!roomMessySlider || !pseudoCleanVal1 || !pseudoCleanOutput) return;
        const isMessy = parseInt(roomMessySlider.value) === 1;
        const ruleConditionIsMet = (isMessy && pseudoCleanVal1.value === "true") || (!isMessy && pseudoCleanVal1.value === "false");
        
        if (ruleConditionIsMet) { // This logic is flawed for live update based on SELECT too
            // Simpler live update:
            if (isMessy){
                 pseudoCleanOutput.textContent = document.getElementById('pseudoCleanAction1').value || "[Action if Messy]";
            } else {
                 pseudoCleanOutput.textContent = document.getElementById('pseudoCleanAction2').value || "[Action if Clean]";
            }
        } else {
             if (!isMessy){
                 pseudoCleanOutput.textContent = document.getElementById('pseudoCleanAction1').value || "[Action if Messy]";
            } else {
                 pseudoCleanOutput.textContent = document.getElementById('pseudoCleanAction2').value || "[Action if Clean]";
            }
        }
    }
    if (roomMessySlider) {
        roomMessySlider.addEventListener('input', () => {
            const isMessy = parseInt(roomMessySlider.value) === 1;
            if(roomMessyValue) roomMessyValue.textContent = isMessy ? "Messy" : "Clean";
            updatePseudoCleanOutput();
        });
    }
    if(pseudoCleanVal1) pseudoCleanVal1.addEventListener('change', updatePseudoCleanOutput);
    if(pseudoCleanAction1) pseudoCleanAction1.addEventListener('input', updatePseudoCleanOutput);
    if(pseudoCleanAction2) pseudoCleanAction2.addEventListener('input', updatePseudoCleanOutput);

    function checkActivity5() {
        const ruleIsTrueWhenMessy = pseudoCleanVal1.value === 'true';
        const action1 = pseudoCleanAction1.value.toLowerCase();
        const action2 = pseudoCleanAction2.value.toLowerCase();
        const feedbackEl = document.getElementById('activity5-feedback');
        if (ruleIsTrueWhenMessy && action1.includes('clean') && action2.includes('standby')) {
            feedbackEl.textContent = "Great job! Your robot knows when to clean.";
            feedbackEl.className = "feedback-message correct";
            markPageComplete();
        } else {
            feedbackEl.textContent = "Check your rule. If room_is_messy is True (messy), it should clean. Otherwise, standby.";
            feedbackEl.className = "feedback-message incorrect";
            pageCompletionStatus[currentPageIndex] = false; updateNextButtonState();
        }
    }

    // --- Activity 6: Flowchart Order ---
    const flowchartContainerAct6 = document.getElementById('flowchart-steps-container');
    const correctFlowchartOrderAct6 = [ "START Assembly", "Get Robot Arm Ready", "Is Part A available?", "Pick up Part A", "Is Part B available?", "Pick up Part B", "Assemble Part A and Part B", "Gadget Complete!", "END Assembly" ];
    let draggedFlowchartItem = null;
    function initializeFlowchartActivity() { 
        if (!flowchartContainerAct6) return;
        flowchartContainerAct6.innerHTML = '';
        const shuffled = [...correctFlowchartOrderAct6].sort(() => Math.random() - 0.5);
        shuffled.forEach(text => {
            const li = document.createElement('li'); li.textContent = text; li.draggable = true;
            li.id = "fc_step_" + text.toLowerCase().replace(/\W+/g, '_');
            flowchartContainerAct6.appendChild(li);
        });
        const items = flowchartContainerAct6.querySelectorAll('li');
        items.forEach(item => {
            item.addEventListener('dragstart', () => { draggedFlowchartItem = item; item.classList.add('dragging'); });
            item.addEventListener('dragend', () => { if(draggedFlowchartItem) draggedFlowchartItem.classList.remove('dragging'); draggedFlowchartItem = null; });
        });
        flowchartContainerAct6.addEventListener('dragover', e => {
            e.preventDefault();
            const afterElement = getDragAfterElementFlowchart(flowchartContainerAct6, e.clientY);
            if (draggedFlowchartItem) {
                if (afterElement == null) flowchartContainerAct6.appendChild(draggedFlowchartItem);
                else flowchartContainerAct6.insertBefore(draggedFlowchartItem, afterElement);
            }
        });
    }
    function getDragAfterElementFlowchart(container, y) {
        const draggableElements = [...container.querySelectorAll('li:not(.dragging)')];
        return draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect(); const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) return { offset: offset, element: child };
            return closest;
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }
    function checkActivity6() { 
        const feedbackEl = document.getElementById('activity6-feedback');
        if (!flowchartContainerAct6) { feedbackEl.textContent = "Error."; feedbackEl.className = "feedback-message incorrect"; return; }
        const currentOrder = [...flowchartContainerAct6.querySelectorAll('li')].map(li => li.textContent);
        let isCorrect = currentOrder.length === correctFlowchartOrderAct6.length && currentOrder.every((val, idx) => val === correctFlowchartOrderAct6[idx]);
        if (isCorrect) {
            feedbackEl.textContent = "Perfect Assembly Line Logic!";
            feedbackEl.className = "feedback-message correct";
            markPageComplete();
        } else {
            feedbackEl.textContent = "The order isn't quite right for efficient assembly. Try again!";
            feedbackEl.className = "feedback-message incorrect";
            pageCompletionStatus[currentPageIndex] = false; updateNextButtonState();
        }
    }
    
    // --- Main Simulation JS (Robot Task Optimizer) ---
    const taskComplexitySlider = document.getElementById('taskComplexitySlider');
    const powerAllocationSlider = document.getElementById('powerAllocationSlider');
    const taskComplexityValue = document.getElementById('taskComplexityValue');
    const powerAllocationValue = document.getElementById('powerAllocationValue');
    const robotMainAvatar = document.getElementById('robot-main-avatar');
    const robotTool = document.getElementById('robot-tool');
    const simProgressBarFg = document.getElementById('sim-progress-bar-fg');
    const simBatteryLevel = document.getElementById('sim-battery-level');
    const readoutComplexity = document.getElementById('readout-complexity');
    const readoutPower = document.getElementById('readout-power');
    const readoutProgress = document.getElementById('readout-progress');
    const readoutBattery = document.getElementById('readout-battery');
    const robotSimStatus = document.getElementById('robot-sim-status');
    const robotSimStatusText = document.getElementById('robot-sim-status-text');
    const simSystemStatusBar = document.getElementById('simSystemStatus');
    const startSimButton = document.getElementById('startSimButton');

    let simInProgress = false; let currentTaskProgress = 0; let currentBattery = 100; let simInterval;
    const SIM_SVG_WIDTH = 400, SIM_SVG_HEIGHT = 225; // For robot sim SVG calculations
    const SIM_THRESHOLD_OPTIMAL = 80; // Battery % for optimal
    const SIM_THRESHOLD_WARNING = 40; // Battery % for warning
    const SIM_THRESHOLD_DANGER = 15;  // Battery % for danger

    if (taskComplexitySlider && powerAllocationSlider) {
        taskComplexitySlider.addEventListener('input', e => { if(taskComplexityValue) taskComplexityValue.textContent = e.target.value; if (!simInProgress) updateSimReadouts(); });
        powerAllocationSlider.addEventListener('input', e => { if(powerAllocationValue) powerAllocationValue.textContent = e.target.value; if (!simInProgress) updateSimReadouts(); });
    }
    if (startSimButton) startSimButton.addEventListener('click', runRobotSimulationCycle);

    function updateSimReadouts(complexity, power, progress, battery, status, statusText, logMsg, logClass) {
        if(readoutComplexity) readoutComplexity.textContent = complexity !== undefined ? complexity : (taskComplexitySlider ? taskComplexitySlider.value : 5);
        if(readoutPower) readoutPower.textContent = power !== undefined ? power + "%" : (powerAllocationSlider ? powerAllocationSlider.value + "%" : "50%");
        if(readoutProgress) readoutProgress.textContent = progress !== undefined ? Math.round(progress) + "%" : Math.round(currentTaskProgress) + "%";
        if(readoutBattery) readoutBattery.textContent = battery !== undefined ? Math.round(battery) + "%" : Math.round(currentBattery) + "%";
        if(robotSimStatus) robotSimStatus.textContent = status || "Ready!";
        if(robotSimStatusText) robotSimStatusText.textContent = statusText || "Awaiting commands.";
        if(robotSimStatus) robotSimStatus.className = `value status-${logClass || 'optimal'}`;


        if(simProgressBarFg) simProgressBarFg.setAttribute('width', ((progress !== undefined ? progress : currentTaskProgress) / 100 * 200).toFixed(1));
        if(simBatteryLevel) {
            let battPercent = battery !== undefined ? battery : currentBattery;
            battPercent = Math.max(0, Math.min(100, battPercent)); // Clamp
            simBatteryLevel.setAttribute('height', (battPercent / 100 * 13).toFixed(1));
            simBatteryLevel.setAttribute('y', (81 + (13 - (battPercent / 100 * 13))).toFixed(1));
            if (battPercent < SIM_THRESHOLD_DANGER) simBatteryLevel.style.fill = 'var(--battery-low-color)';
            else if (battPercent < SIM_THRESHOLD_WARNING) simBatteryLevel.style.fill = 'var(--status-ok)';
            else simBatteryLevel.style.fill = 'var(--battery-full-color)';
        }
        if (logMsg && simSystemStatusBar) {
            simSystemStatusBar.textContent = `[SIM LOG] ${logMsg}`;
            simSystemStatusBar.className = logClass || 'ok';
            simSystemStatusBar.classList.add('visible');
        }
        if(pages[currentPageIndex] && pages[currentPageIndex].id === 'page-simulation') markPageComplete();
    }

    function runRobotSimulationCycle() {
        if (simInProgress) return;
        simInProgress = true;
        if(startSimButton) startSimButton.disabled = true;
        currentTaskProgress = 0; currentBattery = 100;
        let animationFrame = 0;
        const complexity = parseInt(taskComplexitySlider.value); const power = parseInt(powerAllocationSlider.value);
        const progressPerTick = (power / 50) * (1 - (complexity - 1) * 0.05); // Complexity reduces progress speed
        const drainPerTick = (power / 100 * 0.8) + (complexity / 10 * 0.5); // Adjusted drain
        updateSimReadouts(complexity, power, currentTaskProgress, currentBattery, "Working...", "Task in progress.", "Cycle Started.", "ok");
        if (robotMainAvatar) robotMainAvatar.style.transformOrigin = "0px 20px"; // Center of base for rotation
        if (robotTool) robotTool.style.transformOrigin = "0% 50%"; // Pivot point for tool

        simInterval = setInterval(() => {
            animationFrame++;
            if (robotMainAvatar) robotMainAvatar.style.transform = `translate(80px, 112.5px) scale(1.5) rotate(${Math.sin(animationFrame * 0.3) * 2}deg)`;
            if (robotTool) robotTool.style.transform = `rotate(${Math.sin(animationFrame * 0.5) * 10}deg)`;
            currentTaskProgress += progressPerTick; currentBattery -= drainPerTick;
            if (currentTaskProgress >= 100) {
                currentTaskProgress = 100; clearInterval(simInterval); simInProgress = false; if(startSimButton) startSimButton.disabled = false;
                let finalStatus = "Task Complete!"; let finalText = `Finished with ${Math.round(currentBattery)}% battery.`; let finalLog = "best";
                if (currentBattery < SIM_THRESHOLD_WARNING) { finalText += " Could be better!"; finalLog = "ok"; }
                if (currentBattery < SIM_THRESHOLD_DANGER) { finalText = `Low power finish: ${Math.round(currentBattery)}% battery.`; finalLog = "bad"; }
                updateSimReadouts(complexity, power, currentTaskProgress, currentBattery, finalStatus, finalText, "Task Success!", finalLog);
                if(robotMainAvatar) robotMainAvatar.style.transform = `translate(80px, 112.5px) scale(1.5) rotate(0deg)`;
            } else if (currentBattery <= 0) {
                currentBattery = 0; clearInterval(simInterval); simInProgress = false; if(startSimButton) startSimButton.disabled = false;
                updateSimReadouts(complexity, power, currentTaskProgress, currentBattery, "Battery Depleted!", `Task failed at ${Math.round(currentTaskProgress)}%.`, "Battery Critical!", "critical");
                if(robotMainAvatar) robotMainAvatar.style.transform = `translate(80px, 112.5px) scale(1.5) rotate(20deg)`;
            } else {
                let cStatus = "Working...", cStatusTxt = "Task in progress.", cLog = "ok";
                if (currentBattery < SIM_THRESHOLD_DANGER) {cStatus="Critical Power!"; cStatusTxt="Battery very low!"; cLog="critical";}
                else if (currentBattery < SIM_THRESHOLD_WARNING) {cStatus = "Low Power!"; cStatusTxt = "Battery getting low."; cLog = "warning";}
                updateSimReadouts(complexity, power, currentTaskProgress, currentBattery, cStatus, cStatusTxt, `Prog: ${Math.round(currentTaskProgress)}% Batt: ${Math.round(currentBattery)}%`, cLog);
            }
        }, 120); // Faster tick
    }
    
    // --- Initialisation ---
    document.addEventListener('DOMContentLoaded', () => {
        showPage(currentPageIndex); 
        if (pages[currentPageIndex] && pages[currentPageIndex].id === 'page-activity6') initializeFlowchartActivity();
        if (targetReachSlider) { targetReachValue.textContent = parseFloat(targetReachSlider.value).toFixed(1) + "m"; actualArmReachOutput.textContent = parseFloat(targetReachSlider.value).toFixed(1) + "m"; markPageComplete(); } // Activity 3 init
        if (actualBatterySlider && sensorNoiseSlider) { updateBatterySensor(); markPageComplete(); } // Activity 4 init
        if (roomMessySlider) { // Init Activity 5 slider text & output
            roomMessyValue.textContent = parseInt(roomMessySlider.value) === 1 ? "Messy" : "Clean";
            updatePseudoCleanOutput();
        }
        if (taskComplexitySlider) updateSimReadouts(); // Init main simulation readouts
    });
    </script>
</body>
</html>
